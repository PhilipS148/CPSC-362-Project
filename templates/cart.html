<!DOCTYPE html>
<html lang="en">
<head>
    <title>Tuffy Tacos</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/tuffytaco.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='CSSFiles/cart.css') }}">

</head>







    <header>
    <div class="header-grid">
        <a href="{{ url_for('index') }}">
            <img id="tuffy" src="{{ url_for('static', filename='images/tuffytaco.png') }}" height="80" width="80" alt="TuffyTacos">
        </a>
        <h1>Tuffy Tacos - Cart</h1>

        <div class="header-links">
            <a href="{{ url_for('menu_page') }}">View Menu</a>
            <a href="{{ url_for('order_history') }}">View Order History</a>
            <a href="{{ url_for('index') }}">Return to homepage</a>
            
        </div>
    </div>
    </header>

    <div class="tuffy-Cart">
     <img src="{{ url_for('static', filename='images/tuffyCart.png') }}" class="top-logo-img">
    </div>




<div id="cart-container" class="cart-container">
    <h2>Your Cart</h2>

    <div id="cart-box" class="cart-box">
         
    </div>

    <div id="cart-total" class="cart-total">
        
    </div>

    <button class="checkout-btn" onclick="checkout()">Check Out</button>

</div>



<script>
async function loadCart() {
    const res = await fetch("/api/get-cart");
    const data = await res.json();

    const box = document.getElementById("cart-box");
    const totalDiv = document.getElementById("cart-total");

    if (!data.success || data.items.length === 0) {
        box.innerHTML = "<p>Your cart is empty.</p>";
        totalDiv.innerHTML = "";
        return;
    }

    let html = "";
    let total = 0;

    data.items.forEach(item => {
        html += `
            <div class="cart-item">
                <span>${item.name} (x${item.quantity})</span>
                <span>$${(item.price).toFixed(2)}</span>
            </div>
        `;

         
        total += item.price;
    });

    box.innerHTML = html;
    totalDiv.innerHTML = `<strong>Total: $${total.toFixed(2)}</strong>`;
}


loadCart();
</script>

<script>
async function checkout() {
    const btn = document.querySelector(".checkout-btn");
    const box = document.getElementById("cart-box");
    const totalDiv = document.getElementById("cart-total");

     
    btn.disabled = true;
    btn.innerText = "Processing...";
    btn.classList.add("processing");

     
    box.innerHTML = "<p>Processing your order...</p>";
    if (totalDiv) totalDiv.innerHTML = "";

    try {
         
        const res = await fetch("/api/checkout", { method: "POST" });
        const data = await res.json();

        if (data.success) {
             
            await new Promise(resolve => setTimeout(resolve, 1000));

             
            box.innerHTML = `
                <div class="checkout-message">
                    <h3>Checkout complete!</h3>
                    <p>Thank you for your order.</p>
                </div>
            `;
            totalDiv.innerHTML = "";

             
            btn.classList.remove("processing");
            btn.classList.add("complete");
            btn.innerText = "Order Complete";
        } else {
            
            btn.disabled = false;
            btn.innerText = "Checkout Failed";
            box.innerHTML = `<p>Error: ${data.message}</p>`;
        }
    } catch (err) {
         
        btn.disabled = false;
        btn.innerText = "Checkout Failed";
        box.innerHTML = `<p>Unexpected error occurred.</p>`;
        console.error(err);
    }
}
</script>